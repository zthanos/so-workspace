meta:
  id: RA-INTEGRATION-ROUTING
  version: "1.0"
  owner: Enterprise Architecture
  intent: "Determine allowed routing paths across system categories/zones."

rules:
  - id: R-EXT-INGRESS
    description: "External ingress must terminate at perimeter gateways."
    if:
      source.zone: external
      target.zone: cloud_core
    then:
      must_route_via_categories: [gateway]
      disallow_direct: true

  - id: R-CLOUD-SYNC-VIA-GW
    description: "Cloud-to-cloud synchronous calls should pass through gateway (policy + observability)."
    if:
      source.zone: cloud_core
      target.zone: cloud_core
      interaction: sync
    then:
      should_route_via_categories: [gateway]

  - id: R-LEGACY-TO-CLOUD
    description: "Legacy systems must not integrate directly with cloud-native services."
    if:
      source.category: legacy
      target.zone: cloud_core
    then:
      must_route_via_categories: [middleware]
      optional_route_via_categories: [gateway]
      disallow_direct: true
      preferred_interaction: async

  - id: R-CLOUD-TO-LEGACY
    description: "Cloud-to-legacy must route via middleware/adapters; avoid direct calls."
    if:
      source.zone: cloud_core
      target.category: legacy
    then:
      must_route_via_categories: [middleware]
      disallow_direct: true

  - id: R-SaaS-VIA-GW
    description: "Cloud-native to SaaS integrations should be mediated via gateway when HTTP-based."
    if:
      source.category: cloud_native
      target.category: cloud_app
      protocol: http
    then:
      should_route_via_categories: [gateway]

  - id: R-FANOUT-EVENTS
    description: "Fan-out to multiple consumers prefers eventing via middleware."
    if:
      fanout_consumers_gte: 2
    then:
      must_route_via_categories: [middleware]
      preferred_interaction: async

  - id: R-DATA-INGESTION
    description: "Operational systems feed data platform via controlled ingestion (middleware)."
    if:
      target.category: data_platform
    then:
      should_route_via_categories: [middleware]
      preferred_interaction: async

  - id: R-EXTERNAL-OUTBOUND
    description: "Outbound calls to external providers should be policy-controlled."
    if:
      target.category: external
      protocol: http
    then:
      should_route_via_categories: [gateway]
      notes: "Use centralized egress control if available."
